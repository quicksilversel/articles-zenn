---
title: Next.jsã®SSGã‚¢ãƒ—ãƒªã‚’GitHub Actionsã§S3ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•
tags:
  - AWS
  - S3
  - Next.js
  - GitHubActions
private: false
updated_at: '2025-08-12T19:23:14+09:00'
id: 059eb512a9faa58b7ce7
organization_url_name: null
slide: false
ignorePublish: false
---

## SSGã£ã¦ä½•ã ã£ã‘ï¼Ÿ

SSGï¼ˆStatic Site Generationï¼‰ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã§ã¯ãªã**ãƒ“ãƒ«ãƒ‰æ™‚ã«HTMLã‚’ç”Ÿæˆ**ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚  
ã“ã‚Œã«ã‚ˆã‚Šã€ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ãŒé€Ÿãã€ã‚µãƒ¼ãƒãƒ¼ã‚³ã‚¹ãƒˆã‚‚ã‚¼ãƒ­ï¼  
ã‚‚ã—ã€Œã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¦ãšã«ã€ä½ã‚³ã‚¹ãƒˆã§Webã‚µã‚¤ãƒˆã‚’å…¬é–‹ã—ãŸã„ï¼ã€ã¨ã„ã†æ–¹ã«ã¯ã€**S3ã®ã‚ˆã†ãªé™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãŒã¾ã•ã«ãƒ”ãƒƒã‚¿ãƒª**ã§ã™ï¼ˆå®‰ã„ã—ï¼‰ã€‚  

https://nextjs.org/docs/pages/building-your-application/rendering/static-site-generation


## ã‚¹ãƒ†ãƒƒãƒ—1ï¼š`next.config.js` ã‚’æ›´æ–°ã™ã‚‹

Next.jsã«ã€Œé™çš„ã‚µã‚¤ãƒˆã¨ã—ã¦å‡ºåŠ›ã—ã¦ã­ã€ã¨æ•™ãˆã¾ã™ã€‚

```js
// next.config.js
const nextConfig = {
  output: 'export',
}

module.exports = nextConfig
```

## ã‚¹ãƒ†ãƒƒãƒ—ï¼’ï¼šGHAç”¨ã®IAMãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹

S3ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã«ã¯ã€GitHub ActionsãŒS3ã¸ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«IAMãƒ­ãƒ¼ãƒ«ã¨ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ä»¥ä¸‹ã¯CloudFormationã§IAMãƒ­ãƒ¼ãƒ«ã«S3ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹ä¾‹ã§ã™ã€‚ï¼ˆãƒã‚±ãƒƒãƒˆåã‚„ãƒ­ãƒ¼ãƒ«åã¯ãƒã‚¹ã‚¯ã—ã¦ã„ã¾ã™ï¼‰

IAMãƒ­ãƒ¼ãƒ«ï¼ˆGitHub Actions OIDCç”¨ï¼‰
```yaml
IAMRoleExampleForGHA:
  Type: AWS::IAM::Role
  Properties:
    RoleName: !Sub ${ServiceName}-gha
    AssumeRolePolicyDocument:
      Version: 2012-10-17
      Statement:
        - Effect: Allow
          Action: sts:AssumeRoleWithWebIdentity
          Principal:
            Federated: !ImportValue your-platform-base::GithubOidcArn
          Condition:
            StringEquals:
              token.actions.githubusercontent.com:aud:
                - sts.amazonaws.com
            ForAnyValue:StringLike:
              token.actions.githubusercontent.com:sub:
                - !Sub 'repo:${YourRepositoryName}:ref:refs/heads/main'
                - !Sub 'repo:${YourRepositoryName}:pull_request'
                - !Sub 'repo:${YourRepositoryName}:push'
```

IAMãƒãƒªã‚·ãƒ¼ï¼ˆS3ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ä»˜ä¸ç”¨ï¼‰

```yaml
IAMPolicyAccessToS3Example:
  Type: "AWS::IAM::Policy"
  Properties:
    PolicyName: "IAMPolicyAccessToS3Example"
    Roles:
      - !Ref IAMRoleExampleForGHA
    PolicyDocument:
      Version: "2012-10-17"
      Statement:
        - Sid: "AccessToS3Example"
          Effect: "Allow"
          Action:
            - "s3:DeleteObject"
            - "s3:GetObject"
            - "s3:GetObjectAcl"
            - "s3:PutObject"
            - "s3:PutObjectAcl"
            - "s3:ListBucket"
          Resource:
            - !Sub "${S3BucketExample.Arn}"
            - !Sub "${S3BucketExample.Arn}/*"

```

ãƒã‚¤ãƒ³ãƒˆï¼š
- Resource ã«ã¯å¯¾è±¡ã®S3ãƒã‚±ãƒƒãƒˆARNã‚’æŒ‡å®š
- Roles ã«ã¯GitHub Actionsã‹ã‚‰Assume Roleã™ã‚‹IAMãƒ­ãƒ¼ãƒ«åã‚’æŒ‡å®š
- CloudFormationã‚’ä½¿ã‚ãšãƒãƒã‚³ãƒ³ã‹ã‚‰ä½œã£ã¦ã‚‚OKã§ã™ãŒã€Infrastructure as Codeã§ç®¡ç†ã™ã‚‹ã®ãŒãŠã™ã™ã‚

## ã‚¹ãƒ†ãƒƒãƒ—3ï¼šGitHub Actionsã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

GitHub Actionsã‚’ä½¿ã£ã¦ã€Next.jsã‚¢ãƒ—ãƒªã‚’ãƒ“ãƒ«ãƒ‰ â†’ S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æµã‚Œã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚

```yaml
on:
  push:
    branches: ['main']

permissions:
  actions: write
  contents: read
  id-token: write

jobs:
  upload:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: arn:aws:iam::<your-account-id>:role/<your-gha-role>
          aws-region: ap-northeast-1

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 22

      - name: Install Dependencies
        run: npm ci

      - name: Build
        run: npm run build

      - name: Deploy to s3
        run: |
          aws s3 cp --recursive ./out/ s3://your-static-site-bucket-name --acl public-read
```

## æ³¨æ„ãƒã‚¤ãƒ³ãƒˆ

- `getServerSideProps()` ã¯ä½¿ã‚ãšã€`getStaticProps()` ã¾ãŸã¯é€šå¸¸ã®ãƒšãƒ¼ã‚¸ã‚’ä½¿ã†
- å‹•çš„ãƒ«ãƒ¼ãƒˆã¯äº‹å‰ãƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã„ãªã„ã¨å‹•ã‹ãªã„
- S3ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’æ‰±ãˆãªã„ãŸã‚ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå£Šã‚ŒãŸå ´åˆã¯CloudFront + fallbackè¨­å®šãŒå¿…è¦ã«ãªã‚‹ã“ã¨ã‚‚

ã“ã‚Œã§ã€ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã ã‘ã§S3ã«é™çš„ã‚µã‚¤ãƒˆãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™ï¼ğŸš€
ã€Œæ¯å›æ‰‹å‹•ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰â€¦ã€ã‹ã‚‰å’æ¥­ã—ã¦ã€æ¥½ã—ã¾ã—ã‚‡ã†ã€‚
